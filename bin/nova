#!/bin/bash
# Nova Agent Wrapper Script

# Resolve the directory where this script is located
SOURCE="${BASH_SOURCE[0]}"
while [ -h "$SOURCE" ]; do 
  DIR="$( cd -P "$( dirname "$SOURCE" )" && pwd )"
  SOURCE="$(readlink "$SOURCE")"
  [[ $SOURCE != /* ]] && SOURCE="$DIR/$SOURCE" 
done
SCRIPT_DIR="$( cd -P "$( dirname "$SOURCE" )" && pwd )"
PROJECT_ROOT="$(dirname "$SCRIPT_DIR")"

# Check for virtual environment
if [ -f "$PROJECT_ROOT/.venv/bin/activate" ]; then
    VENV_PYTHON="$PROJECT_ROOT/.venv/bin/python3"
else
    echo "‚ùå Virtual environment not found at $PROJECT_ROOT/.venv"
    echo "Please run: python3 -m venv .venv && source .venv/bin/activate && pip install -r requirements.txt && pip install -e ."
    exit 1
fi

# Set PYTHONPATH to include project root so 'import src.xxx' works
export PYTHONPATH="$PROJECT_ROOT:$PYTHONPATH"

# Load .env if it exists
if [ -f "$PROJECT_ROOT/.env" ]; then
    # Filter out comments and empty lines, then export
    export $(grep -v '^#' "$PROJECT_ROOT/.env" | xargs)
fi

# Run the CLI
exec "$VENV_PYTHON" "$PROJECT_ROOT/src/nova_cli.py" "$@"
